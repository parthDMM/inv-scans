<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory Scanner</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex justify-center p-4">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-5 space-y-4">

    <!-- Header -->
    <div class="flex justify-between items-center">
      <h1 class="text-xl font-bold text-gray-800">üì¶ Inventory Scanner</h1>
      <button id="exportCsv"
        class="bg-green-500 hover:bg-green-600 text-white text-sm px-3 py-1 rounded-lg">
        Export CSV
      </button>
    </div>

    <!-- Form -->
    <form id="inventoryForm" class="space-y-3">

      <!-- Item Code -->
      <div>
        <label class="block font-medium text-gray-700 mb-1">Scan / Item Code</label>
        <input
          id="itemCode"
          type="text"
          autocomplete="off"
          autofocus
          placeholder="Scan barcode"
          class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
          required
        />
      </div>

      <!-- Quantity -->
      <div>
        <label class="block font-medium text-gray-700 mb-1">Quantity</label>
        <input
          id="quantity"
          type="number"
          min="1"
          step="1"
          class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
          required
        />
      </div>

      <!-- Location -->
      <div>
        <label class="block font-medium text-gray-700 mb-1">Location</label>
        <input
          id="location"
          type="text"
          placeholder="Enter location"
          class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300"
          required
        />
      </div>

      <button
        type="submit"
        class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded-lg font-medium">
        Add Inventory
      </button>
    </form>

    <!-- Tabs -->
    <div class="flex mt-4">
      <button id="tabEntries"
        class="flex-1 bg-blue-500 text-white py-2 rounded-l-lg">
        Entries
      </button>
      <button id="tabSummary"
        class="flex-1 bg-gray-200 py-2 rounded-r-lg">
        Summary
      </button>
    </div>

    <!-- Entries -->
    <div id="entriesTab" class="space-y-3 mt-3">
      <h2 class="font-semibold text-gray-700">Scanned Items</h2>
      <ul id="inventoryList" class="space-y-2"></ul>
    </div>

    <!-- Summary -->
    <div id="summaryTab" class="hidden space-y-3 mt-3">
      <h2 class="font-semibold text-gray-700">Summary by Location</h2>
      <div id="summaryContainer" class="space-y-3"></div>
    </div>

  </div>

<script>
/* ======================
   STATE & STORAGE
====================== */
let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

function saveLocal() {
  localStorage.setItem('inventory', JSON.stringify(inventory));
}

/* ======================
   DOM ELEMENTS
====================== */
const form = document.getElementById('inventoryForm');
const itemCodeInput = document.getElementById('itemCode');
const quantityInput = document.getElementById('quantity');
const locationInput = document.getElementById('location');
const inventoryList = document.getElementById('inventoryList');
const summaryContainer = document.getElementById('summaryContainer');

/* ======================
   SCANNER FIX (IMPORTANT)
====================== */
// Prevent barcode scanner ENTER from submitting form
itemCodeInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    quantityInput.focus();
  }
});

/* ======================
   FORM SUBMIT
====================== */
form.addEventListener('submit', e => {
  e.preventDefault();

  const itemCode = itemCodeInput.value
    .replace(/[\r\n]+/g, '') // remove scanner CR/LF
    .trim();

  const quantity = parseInt(quantityInput.value);
  const location = locationInput.value.trim();

  if (!itemCode || !quantity || !location) {
    alert('Complete all fields');
    return;
  }

  inventory.push({ itemCode, quantity, location });
  saveLocal();

  renderInventory();
  renderSummary();

  form.reset();
  itemCodeInput.focus();
});

/* ======================
   RENDER INVENTORY
====================== */
function renderInventory() {
  inventoryList.innerHTML = inventory.map((item, i) => `
    <li class="bg-gray-50 border rounded-lg p-3 flex justify-between">
      <div>
        <p class="font-medium">${item.itemCode}</p>
        <p class="text-sm text-gray-600">
          Qty: ${item.quantity} | ${item.location}
        </p>
      </div>
      <div class="flex gap-2">
        <button onclick="editItem(${i})">‚úèÔ∏è</button>
        <button onclick="deleteItem(${i})">‚ùå</button>
      </div>
    </li>
  `).join('');
}

/* ======================
   SUMMARY
====================== */
function renderSummary() {
  const grouped = {};

  inventory.forEach(item => {
    grouped[item.location] ??= [];
    grouped[item.location].push(item);
  });

  summaryContainer.innerHTML = Object.entries(grouped).map(([loc, items]) => `
    <div class="border rounded-lg p-3 bg-gray-50">
      <h3 class="font-semibold text-blue-600 mb-2">${loc}</h3>
      <ul>
        ${items.map(i =>
          `<li class="flex justify-between text-sm">
            <span>${i.itemCode}</span>
            <span>${i.quantity}</span>
          </li>`
        ).join('')}
      </ul>
    </div>
  `).join('');
}

/* ======================
   EDIT / DELETE
====================== */
function deleteItem(index) {
  inventory.splice(index, 1);
  saveLocal();
  renderInventory();
  renderSummary();
}

function editItem(index) {
  const item = inventory[index];
  itemCodeInput.value = item.itemCode;
  quantityInput.value = item.quantity;
  locationInput.value = item.location;
  deleteItem(index);
  itemCodeInput.focus();
}

/* ======================
   TABS
====================== */
document.getElementById('tabEntries').onclick = () => {
  entriesTab.classList.remove('hidden');
  summaryTab.classList.add('hidden');
};

document.getElementById('tabSummary').onclick = () => {
  summaryTab.classList.remove('hidden');
  entriesTab.classList.add('hidden');
  renderSummary();
};

/* ======================
   EXPORT
====================== */
document.getElementById('exportCsv').onclick = () => {
  if (!inventory.length) {
    alert('No inventory to export');
    return;
  }

  const data = [
    ['Item Code', 'Quantity', 'Location'],
    ...inventory.map(i => [i.itemCode, i.quantity, i.location])
  ];

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'Inventory');

  XLSX.writeFile(wb, 'inventory.xlsx');
};

/* ======================
   INIT
====================== */
renderInventory();
renderSummary();
</script>

</body>
</html>
